// Copyright 2017 Lovell Fuller and others.
// SPDX-License-Identifier: Apache-2.0

'use strict';

const fs = require('fs');

<<<<<<< HEAD
/**
 * The path where we can find the ldd
 */
const LDD_PATH = '/usr/bin/ldd';
=======
const LDD_PATH = '/usr/bin/ldd';
const SELF_PATH = '/proc/self/exe';
const MAX_LENGTH = 2048;
>>>>>>> a3c71b8778a2ba2f7774a4d536795c7da9642dd4

/**
 * Read the content of a file synchronous
 *
 * @param {string} path
<<<<<<< HEAD
 * @returns {string}
 */
const readFileSync = (path) => fs.readFileSync(path, 'utf-8');
=======
 * @returns {Buffer}
 */
const readFileSync = (path) => {
  const fd = fs.openSync(path, 'r');
  const buffer = Buffer.alloc(MAX_LENGTH);
  const bytesRead = fs.readSync(fd, buffer, 0, MAX_LENGTH, 0);
  fs.close(fd);
  return buffer.subarray(0, bytesRead);
};
>>>>>>> a3c71b8778a2ba2f7774a4d536795c7da9642dd4

/**
 * Read the content of a file
 *
 * @param {string} path
<<<<<<< HEAD
 * @returns {Promise<string>}
 */
const readFile = (path) => new Promise((resolve, reject) => {
  fs.readFile(path, 'utf-8', (err, data) => {
    if (err) {
      reject(err);
    } else {
      resolve(data);
=======
 * @returns {Promise<Buffer>}
 */
const readFile = (path) => new Promise((resolve, reject) => {
  fs.open(path, 'r', (err, fd) => {
    if (err) {
      reject(err);
    } else {
      const buffer = Buffer.alloc(MAX_LENGTH);
      fs.read(fd, buffer, 0, MAX_LENGTH, 0, (_, bytesRead) => {
        resolve(buffer.subarray(0, bytesRead));
        fs.close(fd);
      });
>>>>>>> a3c71b8778a2ba2f7774a4d536795c7da9642dd4
    }
  });
});

module.exports = {
  LDD_PATH,
<<<<<<< HEAD
=======
  SELF_PATH,
>>>>>>> a3c71b8778a2ba2f7774a4d536795c7da9642dd4
  readFileSync,
  readFile
};
